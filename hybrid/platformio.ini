; ═══════════════════════════════════════════════════════════════════
; AETHER Pulse Firmware - UDPJSON WiFi DMX Node v3.0
; ═══════════════════════════════════════════════════════════════════
;
; SINGLE TRANSPORT: UDP JSON over WiFi (port 6455)
;
; Architecture:
;   Pi (aether-core)
;     └── UDP JSON (port 6455) → ESP32 nodes
;
; Features:
;   - UDP JSON DMX reception (set, fade, blackout)
;   - Full 512-channel output per universe
;   - RS485/DMX output @ 40Hz (continuous from local buffer)
;   - Non-blocking per-channel fade engine
;   - OLED status display
;   - OTA firmware updates
;   - NVS configuration storage
;
; Build:
;   pio run                    # Build firmware
;   pio run -t upload          # Flash to ESP32
;   pio device monitor         # Serial monitor
;
; ═══════════════════════════════════════════════════════════════════

[platformio]
default_envs = pulse
src_dir = src
include_dir = include

; ═══════════════════════════════════════════════════════════════════
; MAIN CONFIGURATION
; ═══════════════════════════════════════════════════════════════════
[env:pulse]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

lib_deps =
    someweisguy/esp_dmx@^4.1.0
    bblanchon/ArduinoJson@^7.0.0
    adafruit/Adafruit SSD1306@^2.5.9
    adafruit/Adafruit GFX Library@^1.11.9
    ; NOTE: ESPAsyncE131 removed - using UDPJSON only

build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DAETHER_FIRMWARE_VERSION_MAJOR=3
    -DAETHER_FIRMWARE_VERSION_MINOR=0
    -DAETHER_FIRMWARE_VERSION_PATCH=0
    -DAETHER_FIRMWARE_FAMILY=\"pulse-udpjson\"
    -DAETHER_OTA_CHANNEL=\"stable\"

build_src_filter =
    +<*>
    -<gateway_main.cpp>

; ═══════════════════════════════════════════════════════════════════
; DEBUG BUILD
; ═══════════════════════════════════════════════════════════════════
[env:pulse_debug]
extends = env:pulse
build_flags =
    ${env:pulse.build_flags}
    -DCORE_DEBUG_LEVEL=3
    -DDEBUG_VERBOSE=1

; ═══════════════════════════════════════════════════════════════════
; BULLETPROOF BUILD - Production-ready UDPJSON v2 Protocol
; ═══════════════════════════════════════════════════════════════════
; Features:
;   - Protocol v2 with compact ch/fill/frame encodings
;   - Sequence number duplicate detection
;   - Comprehensive telemetry counters
;   - Stale flag (no blackout on silence)
;   - MTU-safe payloads (<1200 bytes)
;   - RDM stub for future expansion
; ═══════════════════════════════════════════════════════════════════
[env:pulse_bulletproof]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

lib_deps =
    someweisguy/esp_dmx@^4.1.0
    bblanchon/ArduinoJson@^7.0.0
    adafruit/Adafruit SSD1306@^2.5.9
    adafruit/Adafruit GFX Library@^1.11.9

build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DAETHER_FIRMWARE_VERSION_MAJOR=4
    -DAETHER_FIRMWARE_VERSION_MINOR=0
    -DAETHER_FIRMWARE_VERSION_PATCH=0
    -DAETHER_FIRMWARE_FAMILY=\"pulse-bulletproof\"
    -DAETHER_PROTOCOL_VERSION=2
    -DAETHER_OTA_CHANNEL=\"stable\"

build_src_filter =
    +<*>
    -<main.cpp>
    -<gateway_main.cpp>
    +<bulletproof_main.cpp>

; ═══════════════════════════════════════════════════════════════════
; GATEWAY BUILD - Wired UART input from Pi GPIO
; ═══════════════════════════════════════════════════════════════════
; Hardware connection:
;   Pi GPIO 14 (TX) ──► ESP32 GPIO 3 (RX)
;   Pi GPIO 15 (RX) ◄── ESP32 GPIO 1 (TX)
;   Common Ground
;
; Protocol: JSON commands over UART at 115200 baud
; No WiFi needed - direct wired connection to Pi
; ═══════════════════════════════════════════════════════════════════
[env:pulse_gateway]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

lib_deps =
    someweisguy/esp_dmx@^4.1.0
    bblanchon/ArduinoJson@^7.0.0
    adafruit/Adafruit SSD1306@^2.5.9
    adafruit/Adafruit GFX Library@^1.11.9

build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DAETHER_FIRMWARE_VERSION_MAJOR=3
    -DAETHER_FIRMWARE_VERSION_MINOR=0
    -DAETHER_FIRMWARE_VERSION_PATCH=0
    -DAETHER_FIRMWARE_FAMILY=\"pulse-gateway\"
    -DAETHER_OTA_CHANNEL=\"stable\"
    -DENABLE_GATEWAY=1

build_src_filter =
    +<*>
    -<main.cpp>
    +<gateway_main.cpp>
