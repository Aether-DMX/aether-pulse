; AETHER Pulse ESP-NOW DMX Streaming
; PlatformIO Configuration
;
; Build targets:
;   pio run -e espnow_gateway
;   pio run -e espnow_node
;
; Upload:
;   pio run -e espnow_gateway -t upload
;   pio run -e espnow_node -t upload

[platformio]
default_envs = espnow_gateway, espnow_node
src_dir = .
include_dir = common

[env]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0
    adafruit/Adafruit GFX Library@^1.11.9
    adafruit/Adafruit SSD1306@^2.5.9
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1

; ══════════════════════════════════════════════════════════════════
; ESP-NOW Gateway (connects to Pi, broadcasts DMX)
; ══════════════════════════════════════════════════════════════════
[env:espnow_gateway]
src_filter = 
    +<common/>
    +<gateway/src/>
build_flags = 
    ${env.build_flags}
    -DAETHER_ROLE_GATEWAY=1
    -DTEST_PATTERN_ENABLED=1

; ══════════════════════════════════════════════════════════════════
; ESP-NOW Node (receives ESP-NOW, outputs DMX)
; ══════════════════════════════════════════════════════════════════
[env:espnow_node]
src_filter = 
    +<common/>
    +<node/src/>
lib_deps = 
    ${env.lib_deps}
    someweisguy/esp_dmx@^4.1.0
build_flags = 
    ${env.build_flags}
    -DAETHER_ROLE_NODE=1

; ══════════════════════════════════════════════════════════════════
; Development variants with extra debug output
; ══════════════════════════════════════════════════════════════════
[env:espnow_gateway_debug]
extends = env:espnow_gateway
build_flags = 
    ${env:espnow_gateway.build_flags}
    -DDEBUG_VERBOSE=1
    -DDEBUG_PACKET_HEX=1

[env:espnow_node_debug]
extends = env:espnow_node
build_flags = 
    ${env:espnow_node.build_flags}
    -DDEBUG_VERBOSE=1
    -DDEBUG_PACKET_HEX=1
